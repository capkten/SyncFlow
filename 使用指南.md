# æ–‡ä»¶åŒæ­¥åŠ©æ‰‹ - ä½¿ç”¨æŒ‡å—

## ğŸ“– ç›®å½•

1. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
2. [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜)
3. [ä½¿ç”¨åœºæ™¯](#ä½¿ç”¨åœºæ™¯)
4. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
5. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

---

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows:
venv\Scripts\activate
# Linux/Mac:
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
# å¤åˆ¶ç¤ºä¾‹é…ç½®
copy config.example.yaml config.yaml  # Windows
cp config.example.yaml config.yaml    # Linux
```

### 3. ç¼–è¾‘é…ç½®æ–‡ä»¶

ç¼–è¾‘ `config.yaml`ï¼Œé…ç½®æ‚¨çš„åŒæ­¥ä»»åŠ¡ï¼š

```yaml
sync_tasks:
  - name: "æˆ‘çš„é¡¹ç›®åŒæ­¥"
    source_path: "D:/projects/my-app"  # æºç›®å½•
    target:
      type: "local"                     # æˆ– "ssh"
      path: "E:/backup/my-app"          # ç›®æ ‡ç›®å½•
    enabled: true
    auto_start: true
    eol_normalize: "lf"                 # æ¢è¡Œç¬¦ç»Ÿä¸€ä¸º LF
    exclude_patterns:
      - "*.pyc"
      - "__pycache__"
      - ".git"
```

### 4. å¯åŠ¨æœåŠ¡

```bash
python backend/app.py
```

### 5. è®¿é—® Web ç•Œé¢

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š`http://localhost:8888`

---

## é…ç½®è¯´æ˜

### å…¨å±€é…ç½®

```yaml
global:
  log_level: INFO           # æ—¥å¿—çº§åˆ«ï¼šDEBUG/INFO/WARNING/ERROR
  database_path: ./data/sync.db  # æ•°æ®åº“è·¯å¾„
  web_host: 0.0.0.0        # Web æœåŠ¡ç›‘å¬åœ°å€
  web_port: 8888           # Web æœåŠ¡ç«¯å£
```

### åŒæ­¥ä»»åŠ¡é…ç½®

#### æœ¬åœ°åŒæ­¥ç¤ºä¾‹

```yaml
sync_tasks:
  - name: "æœ¬åœ°å¤‡ä»½"
    source_path: "D:/important_files"
    target:
      type: "local"
      path: "E:/backup"
    enabled: true
    auto_start: true
    eol_normalize: "keep"    # ä¿æŒåŸæ ·
    exclude_patterns:
      - "*.tmp"
      - "*.cache"
    file_extensions: []      # ç©ºåˆ—è¡¨è¡¨ç¤ºåŒæ­¥æ‰€æœ‰ç±»å‹
```

#### SSH è¿œç¨‹åŒæ­¥ç¤ºä¾‹

```yaml
sync_tasks:
  - name: "è¿œç¨‹ä»£ç åŒæ­¥"
    source_path: "D:/projects/my-app"
    target:
      type: "ssh"
      host: "192.168.1.100"
      port: 22
      username: "user"
      password: "your_password"  # æˆ–ä½¿ç”¨ ssh_key_path
      path: "/home/user/my-app"
    enabled: true
    auto_start: true
    eol_normalize: "lf"      # ç»Ÿä¸€ä¸º Unix æ¢è¡Œç¬¦
    exclude_patterns:
      - "*.pyc"
      - "__pycache__"
      - ".git"
      - "node_modules"
      - ".idea"
    file_extensions:         # ä»…åŒæ­¥è¿™äº›ç±»å‹
      - ".py"
      - ".js"
      - ".md"
```

### æ¢è¡Œç¬¦å¤„ç†é€‰é¡¹

- **`lf`**ï¼ˆæ¨èï¼‰ï¼šç»Ÿä¸€ä¸º Unix/Linux é£æ ¼ (`\n`)
  - é€‚ç”¨äºè·¨å¹³å°é¡¹ç›®ã€Git ä»“åº“
  - é¿å… Git ä¸­çš„æ¢è¡Œç¬¦å†²çª
  
- **`crlf`**ï¼šç»Ÿä¸€ä¸º Windows é£æ ¼ (`\r\n`)
  - é€‚ç”¨äºçº¯ Windows ç¯å¢ƒ
  
- **`keep`**ï¼šä¿æŒåŸæ ·ä¸å¤„ç†
  - é€‚ç”¨äºäºŒè¿›åˆ¶æ–‡ä»¶ã€æ•°æ®æ–‡ä»¶

### æ’é™¤è§„åˆ™

æ”¯æŒ glob æ¨¡å¼ï¼š

```yaml
exclude_patterns:
  - "*.pyc"           # æ’é™¤æ‰€æœ‰ .pyc æ–‡ä»¶
  - "*.log"           # æ’é™¤æ—¥å¿—æ–‡ä»¶
  - "__pycache__"     # æ’é™¤ __pycache__ ç›®å½•
  - ".git"            # æ’é™¤ .git ç›®å½•
  - "node_modules"    # æ’é™¤ node_modules ç›®å½•
  - "*.tmp"           # æ’é™¤ä¸´æ—¶æ–‡ä»¶
  - ".DS_Store"       # æ’é™¤ macOS ç³»ç»Ÿæ–‡ä»¶
  - "Thumbs.db"       # æ’é™¤ Windows ç¼©ç•¥å›¾æ–‡ä»¶
```

---

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šå¼€å‘ä»£ç åŒæ­¥

**éœ€æ±‚**ï¼šåœ¨ Windows å¼€å‘ï¼ŒåŒæ­¥åˆ° Linux æœåŠ¡å™¨æµ‹è¯•

**é…ç½®**ï¼š
```yaml
- name: "å¼€å‘ä»£ç åŒæ­¥"
  source_path: "D:/projects/web-app"
  target:
    type: "ssh"
    host: "dev-server.local"
    username: "developer"
    password: "password"
    path: "/var/www/web-app"
  eol_normalize: "lf"        # ç»Ÿä¸€ä¸º LF
  exclude_patterns:
    - "*.pyc"
    - "__pycache__"
    - ".git"
    - "node_modules"
    - ".env"                 # ä¸åŒæ­¥ç¯å¢ƒé…ç½®
```

### åœºæ™¯ 2ï¼šæ–‡æ¡£å¤‡ä»½

**éœ€æ±‚**ï¼šè‡ªåŠ¨å¤‡ä»½é‡è¦æ–‡æ¡£åˆ°å¦ä¸€ä¸ªç£ç›˜

**é…ç½®**ï¼š
```yaml
- name: "æ–‡æ¡£å¤‡ä»½"
  source_path: "D:/Documents"
  target:
    type: "local"
    path: "E:/Backup/Documents"
  eol_normalize: "keep"      # ä¿æŒåŸæ ·
  exclude_patterns:
    - "*.tmp"
    - "~$*"                  # æ’é™¤ Office ä¸´æ—¶æ–‡ä»¶
```

### åœºæ™¯ 3ï¼šå¤šé¡¹ç›®åŒæ­¥

**éœ€æ±‚**ï¼šåŒæ—¶åŒæ­¥å¤šä¸ªé¡¹ç›®

**é…ç½®**ï¼š
```yaml
sync_tasks:
  - name: "é¡¹ç›®A"
    source_path: "D:/projects/project-a"
    target:
      type: "ssh"
      host: "server1.local"
      path: "/home/user/project-a"
    # ...
    
  - name: "é¡¹ç›®B"
    source_path: "D:/projects/project-b"
    target:
      type: "ssh"
      host: "server2.local"
      path: "/home/user/project-b"
    # ...
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•ä½¿ç”¨ SSH å¯†é’¥è®¤è¯ï¼Ÿ

**A**: åœ¨é…ç½®ä¸­æŒ‡å®š `ssh_key_path` è€Œä¸æ˜¯ `password`ï¼š

```yaml
target:
  type: "ssh"
  host: "192.168.1.100"
  username: "user"
  ssh_key_path: "C:/Users/YourName/.ssh/id_rsa"  # Windows
  # æˆ– "/home/user/.ssh/id_rsa"  # Linux
  path: "/home/user/my-app"
```

### Q2: å¦‚ä½•æŸ¥çœ‹åŒæ­¥æ—¥å¿—ï¼Ÿ

**A**: 
1. **Web ç•Œé¢**ï¼šè®¿é—® `http://localhost:8888`ï¼Œç‚¹å‡»"åŒæ­¥æ—¥å¿—"
2. **æ—¥å¿—æ–‡ä»¶**ï¼šæŸ¥çœ‹ `logs/file_sync_YYYY-MM-DD.log`

### Q3: å¦‚ä½•æ‰‹åŠ¨è§¦å‘å…¨é‡åŒæ­¥ï¼Ÿ

**A**: 
1. **Web ç•Œé¢**ï¼šåœ¨ä»»åŠ¡åˆ—è¡¨ä¸­ç‚¹å‡»"å…¨é‡åŒæ­¥"æŒ‰é’®
2. **API**ï¼š`POST /api/tasks/{task_id}/sync`

### Q4: æ¢è¡Œç¬¦å¤„ç†ä¼šå½±å“æ€§èƒ½å—ï¼Ÿ

**A**: å½±å“å¾ˆå°ã€‚æ¢è¡Œç¬¦å¤„ç†ä»…å¯¹æ–‡æœ¬æ–‡ä»¶ç”Ÿæ•ˆï¼Œä¸”ä½¿ç”¨äº†é«˜æ•ˆçš„å­—èŠ‚æµå¤„ç†ã€‚äºŒè¿›åˆ¶æ–‡ä»¶ç›´æ¥å¤åˆ¶ï¼Œä¸å—å½±å“ã€‚

### Q5: å¦‚ä½•æš‚åœæŸä¸ªä»»åŠ¡ï¼Ÿ

**A**: 
1. **Web ç•Œé¢**ï¼šç‚¹å‡»ä»»åŠ¡çš„"åœæ­¢"æŒ‰é’®
2. **é…ç½®æ–‡ä»¶**ï¼šè®¾ç½® `enabled: false` å¹¶é‡å¯æœåŠ¡

### Q6: æ”¯æŒåŒå‘åŒæ­¥å—ï¼Ÿ

**A**: å½“å‰ç‰ˆæœ¬ä»…æ”¯æŒå•å‘åŒæ­¥ï¼ˆæº â†’ ç›®æ ‡ï¼‰ã€‚åŒå‘åŒæ­¥éœ€è¦å†²çªè§£å†³æœºåˆ¶ï¼Œè®¡åˆ’åœ¨æœªæ¥ç‰ˆæœ¬å®ç°ã€‚

---

## æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šSSH è¿æ¥å¤±è´¥

**ç—‡çŠ¶**ï¼šæ—¥å¿—æ˜¾ç¤º "SSH è¿æ¥å¤±è´¥"

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ä¸»æœºåœ°å€å’Œç«¯å£æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ SSH æœåŠ¡å·²å¯åŠ¨ï¼š`systemctl status sshd`ï¼ˆLinuxï¼‰
3. æµ‹è¯• SSH è¿æ¥ï¼š`ssh user@host -p 22`
4. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
5. ç¡®è®¤ç”¨æˆ·åå’Œå¯†ç /å¯†é’¥æ­£ç¡®

### é—®é¢˜ 2ï¼šæ–‡ä»¶åŒæ­¥å¤±è´¥

**ç—‡çŠ¶**ï¼šæ—¥å¿—æ˜¾ç¤º "åŒæ­¥å¤±è´¥"

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æºç›®å½•æ˜¯å¦å­˜åœ¨
2. æ£€æŸ¥ç›®æ ‡ç›®å½•æƒé™
3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼š`logs/errors_YYYY-MM-DD.log`
4. ç¡®è®¤ç£ç›˜ç©ºé—´å……è¶³

### é—®é¢˜ 3ï¼šWeb ç•Œé¢æ— æ³•è®¿é—®

**ç—‡çŠ¶**ï¼šæµè§ˆå™¨æ— æ³•æ‰“å¼€ `http://localhost:8888`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨ï¼šæŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š`netstat -ano | findstr 8888`ï¼ˆWindowsï¼‰
3. å°è¯•æ›´æ¢ç«¯å£ï¼šä¿®æ”¹ `config.yaml` ä¸­çš„ `web_port`
4. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### é—®é¢˜ 4ï¼šä»»åŠ¡æ— æ³•å¯åŠ¨

**ç—‡çŠ¶**ï¼šç‚¹å‡»"å¯åŠ¨"æŒ‰é’®åä»»åŠ¡ä»æ˜¾ç¤º"å·²åœæ­¢"

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶äº†è§£è¯¦ç»†é”™è¯¯
2. æ£€æŸ¥æºç›®å½•è·¯å¾„æ˜¯å¦æ­£ç¡®
3. å¯¹äº SSH ä»»åŠ¡ï¼Œç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
4. é‡å¯æœåŠ¡

### é—®é¢˜ 5ï¼šæ¢è¡Œç¬¦æœªç»Ÿä¸€

**ç—‡çŠ¶**ï¼šåŒæ­¥åæ–‡ä»¶æ¢è¡Œç¬¦ä»ç„¶ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤ `eol_normalize` è®¾ç½®ä¸º `lf` æˆ– `crlf`ï¼ˆä¸æ˜¯ `keep`ï¼‰
2. ç¡®è®¤æ–‡ä»¶è¢«è¯†åˆ«ä¸ºæ–‡æœ¬æ–‡ä»¶ï¼ˆæ£€æŸ¥æ‰©å±•åï¼‰
3. æ‰‹åŠ¨è§¦å‘å…¨é‡åŒæ­¥
4. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤æ–‡ä»¶æ˜¯å¦è¢«å¤„ç†

---

## è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
python tests/run_tests.py

# è¿è¡Œå•ä¸ªæµ‹è¯•æ–‡ä»¶
python -m unittest tests/test_eol_normalizer.py
```

---

## ç³»ç»ŸæœåŠ¡é…ç½®ï¼ˆå¯é€‰ï¼‰

### Windows æœåŠ¡

ä½¿ç”¨ NSSM å°†ç¨‹åºæ³¨å†Œä¸º Windows æœåŠ¡ï¼š

```bash
# ä¸‹è½½ NSSM: https://nssm.cc/download
nssm install FileSyncHelper "D:\codes\tongbu\venv\Scripts\python.exe" "D:\codes\tongbu\backend\app.py"
nssm start FileSyncHelper
```

### Linux æœåŠ¡

åˆ›å»º systemd æœåŠ¡æ–‡ä»¶ `/etc/systemd/system/file-sync.service`ï¼š

```ini
[Unit]
Description=æ–‡ä»¶åŒæ­¥åŠ©æ‰‹
After=network.target

[Service]
Type=simple
User=your-user
WorkingDirectory=/path/to/tongbu
ExecStart=/path/to/tongbu/venv/bin/python backend/app.py
Restart=always

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl daemon-reload
sudo systemctl enable file-sync
sudo systemctl start file-sync
```

---

**æ–‡ä»¶åŒæ­¥åŠ©æ‰‹** - è®©è·¨å¹³å°å¼€å‘æ›´è½»æ¾ ğŸš€
