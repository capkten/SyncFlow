<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡ä»¶åŒæ­¥åŠ©æ‰‹ - ç®¡ç†ç•Œé¢</title>
    <meta name="description" content="è·¨å¹³å°æ–‡ä»¶å®æ—¶åŒæ­¥å·¥å…· - Windows/Linux æ–‡ä»¶åŒæ­¥ç®¡ç†">

    <!-- Element Plus CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">

    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <link rel="stylesheet" href="/static/css/style.css?v=2.0.0">



    <style>
        /* å¼ºåˆ¶ä¿®å¤å¸ƒå±€é—®é¢˜çš„å†…è”æ ·å¼ */
        html,
        body,
        #app {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .app-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-container {
            display: flex;
            flex: 1;
            width: 100%;
            overflow: hidden;
        }

        .app-aside {
            height: 100%;
            width: 200px;
            flex-shrink: 0;
            overflow-y: auto;
        }

        .app-main {
            flex: 1;
            width: 0;
            min-width: 0;
            height: 100%;
            overflow: auto;
            padding: 20px;
            box-sizing: border-box;
            background-color: #f5f7fa;
        }

        /* ç¡®ä¿å†…å®¹å®¹å™¨æ’‘æ»¡ */
        .dashboard,
        .tasks,
        .logs,
        .settings {
            width: 100%;
        }

        /* è¡¨æ ¼å®¹å™¨å…è®¸æ°´å¹³æ»šåŠ¨ */
        .content-card {
            overflow-x: auto;
        }

        /* [å…³é”®] é˜²æ­¢ Vue æ¨¡æ¿é—ªçƒ */
        [v-cloak] {
            display: none !important;
        }

        /* [å…³é”®] åˆå§‹ Loading é®ç½© */
        #app-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            z-index: 99999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            transition: opacity 0.5s ease-out;
        }

        #app-loader.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <!-- çº¯ HTML Loading é®ç½©ï¼Œä¸ä¾èµ– Vueï¼Œç¬é—´æ˜¾ç¤º -->
    <div id="app-loader">
        <div class="spinner"></div>
        <div style="font-family: 'Segoe UI', sans-serif; font-size: 16px; letter-spacing: 1px;">åŠ è½½æ•°æ®ä¸­...</div>
    </div>

    <div id="app" v-cloak>
        <div class="app-container">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <div class="app-header">
                <div class="header-content">
                    <h1>ğŸ“ æ–‡ä»¶åŒæ­¥åŠ©æ‰‹</h1>
                    <div class="header-stats">
                        <el-tag type="success">è¿è¡Œä¸­: {{ runningCount }}</el-tag>
                        <el-tag type="info">æ€»ä»»åŠ¡: {{ tasks.length }}</el-tag>
                        <el-tag :type="wsStatusType">{{ wsStatusText }}</el-tag>
                        <el-text size="small" type="info">{{ wsHeartbeatText }}</el-text>
                        <el-text v-if="wsReconnectHint" size="small" type="warning">{{ wsReconnectHint }}</el-text>
                    </div>
                </div>
            </div>

            <!-- ä¸»å†…å®¹åŒº -->
            <div class="main-container">
                <!-- ä¾§è¾¹æ  -->
                <div class="app-aside">
                    <el-menu :default-active="activeMenu" @select="handleMenuSelect">
                        <el-menu-item index="dashboard">
                            <el-icon>
                                <Odometer />
                            </el-icon>
                            <span>ä»ªè¡¨ç›˜</span>
                        </el-menu-item>
                        <el-menu-item index="tasks">
                            <el-icon>
                                <List />
                            </el-icon>
                            <span>ä»»åŠ¡ç®¡ç†</span>
                        </el-menu-item>
                        <el-menu-item index="logs">
                            <el-icon>
                                <Document />
                            </el-icon>
                            <span>åŒæ­¥æ—¥å¿—</span>
                        </el-menu-item>
                        <el-menu-item index="settings">
                            <el-icon>
                                <Setting />
                            </el-icon>
                            <span>è®¾ç½®</span>
                        </el-menu-item>
                    </el-menu>
                </div>

                <!-- å†…å®¹åŒº -->
                <div class="app-main">
                    <!-- ä»ªè¡¨ç›˜ -->
                    <div v-if="activeMenu === 'dashboard'" class="dashboard">
                        <h2>ğŸ“Š ä»ªè¡¨ç›˜</h2>

                        <el-row :gutter="20">
                            <el-col :span="6">
                                <el-card class="stat-card">
                                    <div class="stat-number">{{ tasks.length }}</div>
                                    <div class="stat-label">æ€»ä»»åŠ¡æ•°</div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="stat-card success">
                                    <div class="stat-number">{{ runningCount }}</div>
                                    <div class="stat-label">è¿è¡Œä¸­</div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="stat-card info">
                                    <div class="stat-number">{{ logStats.success || 0 }}</div>
                                    <div class="stat-label">æˆåŠŸåŒæ­¥</div>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="stat-card danger">
                                    <div class="stat-number">{{ logStats.failed || 0 }}</div>
                                    <div class="stat-label">åŒæ­¥å¤±è´¥</div>
                                </el-card>
                            </el-col>
                        </el-row>

                        <el-card class="recent-logs-card">
                            <template #header>
                                <div class="card-header">
                                    <span>ğŸ“‹ æœ€è¿‘åŒæ­¥è®°å½•</span>
                                    <el-button type="primary" size="small" @click="activeMenu = 'logs'">æŸ¥çœ‹å…¨éƒ¨</el-button>
                                </div>
                            </template>
                            <!-- è‡ªå®šä¹‰è¡¨æ ¼ -->
                            <div class="simple-table logs-table">
                                <div class="simple-table-header">
                                    <div class="log-col-event">äº‹ä»¶</div>
                                    <div class="log-col-path">æ–‡ä»¶è·¯å¾„</div>
                                    <div class="log-col-status">çŠ¶æ€</div>
                                    <div class="log-col-time">æ—¶é—´</div>
                                </div>
                                <div v-if="recentLogs.length === 0" class="simple-table-empty">
                                    æš‚æ— åŒæ­¥è®°å½•
                                </div>
                                <div v-for="log in recentLogs" :key="log.id" class="simple-table-row">
                                    <div class="log-col-event">
                                        <el-tag :type="getEventTypeTag(log.event_type)" size="small">
                                            {{ getEventTypeName(log.event_type) }}
                                        </el-tag>
                                    </div>
                                    <div class="log-col-path" :title="log.file_path">{{ log.file_path }}</div>
                                    <div class="log-col-status">
                                        <el-tag :type="log.status === 'success' ? 'success' : 'danger'" size="small">
                                            {{ log.status === 'success' ? 'æˆåŠŸ' : 'å¤±è´¥' }}
                                        </el-tag>
                                    </div>
                                    <div class="log-col-time">{{ formatTime(log.sync_time) }}</div>
                                </div>
                            </div>
                        </el-card>
                    </div>

                    <!-- ä»»åŠ¡ç®¡ç† -->
                    <div v-if="activeMenu === 'tasks'" class="tasks">
                        <div class="page-header">
                            <h2>ğŸ“ ä»»åŠ¡ç®¡ç†</h2>
                            <div class="page-actions">
                                <el-button @click="loadTasks">
                                    <el-icon>
                                        <Refresh />
                                    </el-icon> åˆ·æ–°
                                </el-button>
                                <el-button type="primary" @click="showCreateDialog">
                                    <el-icon>
                                        <Plus />
                                    </el-icon> æ–°å»ºä»»åŠ¡
                                </el-button>
                            </div>
                        </div>

                        <el-card class="content-card" shadow="never">
                            <div class="table-toolbar">
                                <el-input v-model="taskFilters.query" clearable placeholder="æœç´¢ï¼šä»»åŠ¡å / æºç›®å½• / ç›®æ ‡è·¯å¾„"
                                    style="max-width: 360px" @clear="resetTasksPage" @input="resetTasksPage">
                                    <template #prefix>
                                        <el-icon>
                                            <Search />
                                        </el-icon>
                                    </template>
                                </el-input>

                                <el-select v-model="taskFilters.targetType" clearable placeholder="ç±»å‹"
                                    style="width: 100px" @change="resetTasksPage"
                                    @clear="taskFilters.targetType = ''; resetTasksPage()">
                                    <el-option label="æœ¬åœ°" value="local" />
                                    <el-option label="SSH" value="ssh" />
                                </el-select>

                                <el-select v-model="taskFilters.running" clearable placeholder="çŠ¶æ€" style="width: 100px"
                                    @change="resetTasksPage" @clear="taskFilters.running = null; resetTasksPage()">
                                    <el-option label="è¿è¡Œä¸­" :value="true" />
                                    <el-option label="å·²åœæ­¢" :value="false" />
                                </el-select>
                            </div>

                            <!-- ä½¿ç”¨ç®€å•çš„divè¡¨æ ¼å¸ƒå±€ -->
                            <div class="simple-table">
                                <div class="simple-table-header">
                                    <div class="col-name">ä»»åŠ¡åç§°</div>
                                    <div class="col-mode">æ¨¡å¼</div>
                                    <div class="col-source">æºç›®å½•</div>
                                    <div class="col-target">ç›®æ ‡</div>
                                    <div class="col-path">ç›®æ ‡è·¯å¾„</div>
                                    <div class="col-status">çŠ¶æ€</div>
                                    <div class="col-actions">æ“ä½œ</div>
                                </div>
                                <div v-if="pagedTasks.length === 0" class="simple-table-empty">
                                    æš‚æ— ä»»åŠ¡ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’ã€Œæ–°å»ºä»»åŠ¡ã€åˆ›å»º
                                </div>
                                <div v-for="task in pagedTasks" :key="task.id" class="simple-table-row">
                                    <div class="col-name" :title="task.name">{{ task.name }}</div>
                                    <div class="col-mode">
                                        <el-tag :type="task.mode === 'two_way' ? 'success' : 'info'" size="small">
                                            {{ task.mode === 'two_way' ? 'åŒå‘' : 'å•å‘' }}
                                        </el-tag>
                                    </div>
                                    <div class="col-source" :title="task.source_path">{{ task.source_path }}</div>
                                    <div class="col-target" :title="getTargetSummary(task)">{{ getTargetSummary(task) }}
                                    </div>
                                    <div class="col-path" :title="task.target_path">{{ task.target_path }}</div>
                                    <div class="col-status">
                                        <el-tag :type="task.is_running ? 'success' : 'info'" size="small">
                                            {{ task.is_running ? 'è¿è¡Œä¸­' : 'å·²åœæ­¢' }}
                                        </el-tag>
                                    </div>
                                    <div class="col-actions">
                                        <el-button v-if="!task.is_running" type="success" size="small"
                                            @click="startTask(task.id)">å¯åŠ¨</el-button>
                                        <el-button v-else type="warning" size="small"
                                            @click="stopTask(task.id)">åœæ­¢</el-button>
                                        <el-button type="primary" size="small"
                                            @click="syncTaskAll(task.id)">å…¨é‡</el-button>
                                        <el-button size="small" @click="openTaskDetail(task)">è¯¦æƒ…</el-button>
                                        <el-button size="small" @click="editTask(task)">ç¼–è¾‘</el-button>
                                        <el-button type="danger" size="small"
                                            @click="deleteTask(task.id)">åˆ é™¤</el-button>
                                    </div>
                                </div>
                            </div>

                            <div class="table-footer">
                                <el-pagination :current-page="tasksPage" :page-size="tasksPageSize"
                                    :page-sizes="[10, 20, 50, 100]" :total="filteredTasks.length"
                                    layout="total, sizes, prev, pager, next" @current-change="handleTasksPageChange"
                                    @size-change="handleTasksPageSizeChange" />
                            </div>
                        </el-card>
                    </div>

                    <!-- åŒæ­¥æ—¥å¿— -->
                    <div v-if="activeMenu === 'logs'" class="logs">
                        <div class="page-header">
                            <h2>ğŸ“„ åŒæ­¥æ—¥å¿—</h2>
                            <div class="page-actions">
                                <el-button @click="loadLogs">
                                    <el-icon>
                                        <Refresh />
                                    </el-icon> åˆ·æ–°
                                </el-button>
                            </div>
                        </div>

                        <el-card class="content-card" shadow="never">
                            <div class="table-toolbar">
                                <el-select v-model="selectedLogTaskId" filterable clearable placeholder="é€‰æ‹©ä»»åŠ¡æŸ¥çœ‹æ—¥å¿—"
                                    style="min-width: 360px" @change="handleLogTaskChange"
                                    @clear="selectedLogTaskId = null; logs = []">
                                    <el-option v-for="t in tasks" :key="t.id" :label="getTaskOptionLabel(t)"
                                        :value="t.id" />
                                </el-select>

                                <el-select v-model="logFilters.status" clearable placeholder="çŠ¶æ€" style="width: 160px"
                                    @clear="logFilters.status = ''">
                                    <el-option label="æˆåŠŸ" value="success" />
                                    <el-option label="å¤±è´¥" value="failed" />
                                    <el-option label="è·³è¿‡" value="skipped" />
                                </el-select>

                                <el-text type="info" size="small" v-if="selectedLogTask">
                                    å½“å‰ï¼š{{ selectedLogTask.name }}ï¼ˆ{{ selectedLogTask.source_path }} â†’ {{
                                    selectedLogTask.target_path }}ï¼‰
                                </el-text>
                                <el-text type="info" size="small" v-if="selectedLogTask">
                                    ä»…æ˜¾ç¤ºæœ€è¿‘ {{ logsLimit }} æ¡
                                </el-text>
                            </div>

                            <!-- åŒæ­¥æ—¥å¿—è‡ªå®šä¹‰è¡¨æ ¼ -->
                            <div class="simple-table logs-table" style="max-height: 600px; overflow-y: auto;">
                                <div class="simple-table-header">
                                    <div class="log-col-event">äº‹ä»¶</div>
                                    <div class="log-col-path">æ–‡ä»¶è·¯å¾„</div>
                                    <div class="log-col-status">çŠ¶æ€</div>
                                    <div class="log-col-error">é”™è¯¯ä¿¡æ¯</div>
                                    <div class="log-col-time">æ—¶é—´</div>
                                </div>
                                <div v-if="!selectedLogTaskId" class="simple-table-empty">
                                    è¯·é€‰æ‹©ä»»åŠ¡æŸ¥çœ‹æ—¥å¿—
                                </div>
                                <div v-else-if="filteredLogs.length === 0" class="simple-table-empty">
                                    æš‚æ— æ—¥å¿—
                                </div>
                                <div v-for="log in filteredLogs" :key="log.id" class="simple-table-row">
                                    <div class="log-col-event">
                                        <el-tag :type="getEventTypeTag(log.event_type)" size="small">
                                            {{ getEventTypeName(log.event_type) }}
                                        </el-tag>
                                    </div>
                                    <div class="log-col-path" :title="log.file_path">{{ log.file_path }}</div>
                                    <div class="log-col-status">
                                        <el-tag
                                            :type="log.status === 'success' ? 'success' : (log.status === 'skipped' ? 'info' : 'danger')"
                                            size="small">
                                            {{ log.status === 'success' ? 'æˆåŠŸ' : (log.status === 'skipped' ? 'è·³è¿‡' :
                                            'å¤±è´¥') }}
                                        </el-tag>
                                    </div>
                                    <div class="log-col-error" :title="log.error_message">{{ log.error_message || '-' }}
                                    </div>
                                    <div class="log-col-time">{{ formatTime(log.sync_time) }}</div>
                                </div>
                            </div>
                        </el-card>
                    </div>

                    <!-- è®¾ç½® -->
                    <div v-if="activeMenu === 'settings'" class="settings">
                        <h2>âš™ï¸ è®¾ç½®</h2>
                        <el-card style="margin-bottom: 16px">
                            <template #header>
                                <span>è®¿é—®è®¤è¯</span>
                            </template>
                            <el-form label-width="120px">
                                <el-form-item label="API Token">
                                    <el-input v-model="authTokenInput" type="password" placeholder="ä»…ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°"
                                        show-password />
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="saveAuthToken">ä¿å­˜ä»¤ç‰Œ</el-button>
                                    <el-text type="info" size="small">ä»¤ç‰Œä¸ä¼šå†™å…¥é…ç½®æ–‡ä»¶</el-text>
                                </el-form-item>
                            </el-form>
                        </el-card>
                        <el-card>
                            <template #header>
                                <span>å…¨å±€é…ç½®</span>
                            </template>
                            <el-form :model="globalConfig" label-width="120px">
                                <el-form-item label="æ—¥å¿—çº§åˆ«">
                                    <el-select v-model="globalConfig.log_level">
                                        <el-option label="DEBUG" value="DEBUG" />
                                        <el-option label="INFO" value="INFO" />
                                        <el-option label="WARNING" value="WARNING" />
                                        <el-option label="ERROR" value="ERROR" />
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="Web ç«¯å£">
                                    <el-input-number v-model="globalConfig.web_port" :min="1024" :max="65535" />
                                </el-form-item>
                                <el-form-item label="SSH ä¸»æœºç­–ç•¥">
                                    <el-select v-model="globalConfig.ssh_host_key_policy">
                                        <el-option label="æ‹’ç»æœªçŸ¥" value="reject" />
                                        <el-option label="è‡ªåŠ¨æ¥å—" value="auto" />
                                        <el-option label="è­¦å‘Šæ¨¡å¼" value="warning" />
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="known_hosts">
                                    <el-input v-model="globalConfig.ssh_known_hosts_path" />
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="saveGlobalConfig">ä¿å­˜é…ç½®</el-button>
                                    <el-text type="info" size="small">æ³¨æ„ï¼šä¿®æ”¹ç«¯å£åéœ€è¦é‡å¯æœåŠ¡</el-text>
                                </el-form-item>
                            </el-form>
                        </el-card>
                    </div>
                </div>
            </div>
        </div>

        <!-- åˆ›å»º/ç¼–è¾‘ä»»åŠ¡å¯¹è¯æ¡† -->
        <el-dialog v-model="taskDialogVisible" :title="isEditMode ? 'ç¼–è¾‘ä»»åŠ¡' : 'æ–°å»ºä»»åŠ¡'" width="600px">
            <el-form :model="taskForm" label-width="120px">
                <el-form-item label="ä»»åŠ¡åç§°" required>
                    <el-input v-model="taskForm.name" placeholder="ä¾‹å¦‚ï¼šé¡¹ç›®ä»£ç åŒæ­¥" />
                </el-form-item>
                <el-form-item label="åŒæ­¥æ¨¡å¼">
                    <el-radio-group v-model="taskForm.mode" @change="handleModeChange">
                        <el-radio value="one_way">å•å‘</el-radio>
                        <el-radio value="two_way">åŒå‘</el-radio>
                    </el-radio-group>
                </el-form-item>

                <template v-if="taskForm.mode === 'one_way'">
                    <el-form-item label="æºç›®å½•" required>
                        <el-input v-model="taskForm.source_path" placeholder="D:/projects/my-app" />
                    </el-form-item>
                    <el-form-item label="ç›®æ ‡ç±»å‹" required>
                        <el-radio-group v-model="taskForm.target_type">
                            <el-radio value="local">æœ¬åœ°</el-radio>
                            <el-radio value="ssh">SSH è¿œç¨‹</el-radio>
                        </el-radio-group>
                    </el-form-item>

                    <template v-if="taskForm.target_type === 'ssh'">
                        <el-form-item label="ä¸»æœºåœ°å€" required>
                            <el-input v-model="taskForm.target_host" placeholder="192.168.1.100" />
                        </el-form-item>
                        <el-form-item label="ç«¯å£">
                            <el-input-number v-model="taskForm.target_port" :min="1" :max="65535" />
                        </el-form-item>
                        <el-form-item label="ç”¨æˆ·å" required>
                            <el-input v-model="taskForm.target_username" placeholder="user" />
                        </el-form-item>
                        <el-form-item label="å¯†ç ">
                            <el-input v-model="taskForm.target_password" type="password" placeholder="ç•™ç©ºä½¿ç”¨ SSH å¯†é’¥" />
                        </el-form-item>
                        <el-form-item label="SSH å¯†é’¥è·¯å¾„">
                            <el-input v-model="taskForm.target_ssh_key_path" placeholder="/path/to/id_rsa" />
                        </el-form-item>
                    </template>

                    <el-form-item label="ç›®æ ‡è·¯å¾„" required>
                        <el-input v-model="taskForm.target_path" placeholder="E:/backup æˆ– /home/user/my-app" />
                    </el-form-item>
                </template>

                <template v-else>
                    <el-divider>ç«¯ç‚¹ A</el-divider>
                    <el-form-item label="ç«¯ç‚¹Aç±»å‹" required>
                        <el-radio-group v-model="taskForm.endpoint_a.type">
                            <el-radio value="local">æœ¬åœ°</el-radio>
                            <el-radio value="ssh">SSH è¿œç¨‹</el-radio>
                        </el-radio-group>
                    </el-form-item>
                    <el-form-item label="ç«¯ç‚¹Aè·¯å¾„" required>
                        <el-input v-model="taskForm.endpoint_a.path" placeholder="D:/projects/my-app" />
                    </el-form-item>
                    <template v-if="taskForm.endpoint_a.type === 'ssh'">
                        <el-form-item label="ä¸»æœºåœ°å€" required>
                            <el-input v-model="taskForm.endpoint_a.host" placeholder="192.168.1.100" />
                        </el-form-item>
                        <el-form-item label="ç«¯å£">
                            <el-input-number v-model="taskForm.endpoint_a.port" :min="1" :max="65535" />
                        </el-form-item>
                        <el-form-item label="ç”¨æˆ·å" required>
                            <el-input v-model="taskForm.endpoint_a.username" placeholder="user" />
                        </el-form-item>
                        <el-form-item label="å¯†ç ">
                            <el-input v-model="taskForm.endpoint_a.password" type="password"
                                placeholder="ç•™ç©ºä½¿ç”¨ SSH å¯†é’¥" />
                        </el-form-item>
                        <el-form-item label="SSH å¯†é’¥è·¯å¾„">
                            <el-input v-model="taskForm.endpoint_a.ssh_key_path" placeholder="/path/to/id_rsa" />
                        </el-form-item>
                    </template>

                    <el-divider>ç«¯ç‚¹ B</el-divider>
                    <el-form-item label="ç«¯ç‚¹Bç±»å‹" required>
                        <el-radio-group v-model="taskForm.endpoint_b.type">
                            <el-radio value="local">æœ¬åœ°</el-radio>
                            <el-radio value="ssh">SSH è¿œç¨‹</el-radio>
                        </el-radio-group>
                    </el-form-item>
                    <el-form-item label="ç«¯ç‚¹Bè·¯å¾„" required>
                        <el-input v-model="taskForm.endpoint_b.path" placeholder="E:/backup æˆ– /home/user/my-app" />
                    </el-form-item>
                    <template v-if="taskForm.endpoint_b.type === 'ssh'">
                        <el-form-item label="ä¸»æœºåœ°å€" required>
                            <el-input v-model="taskForm.endpoint_b.host" placeholder="192.168.1.100" />
                        </el-form-item>
                        <el-form-item label="ç«¯å£">
                            <el-input-number v-model="taskForm.endpoint_b.port" :min="1" :max="65535" />
                        </el-form-item>
                        <el-form-item label="ç”¨æˆ·å" required>
                            <el-input v-model="taskForm.endpoint_b.username" placeholder="user" />
                        </el-form-item>
                        <el-form-item label="å¯†ç ">
                            <el-input v-model="taskForm.endpoint_b.password" type="password"
                                placeholder="ç•™ç©ºä½¿ç”¨ SSH å¯†é’¥" />
                        </el-form-item>
                        <el-form-item label="SSH å¯†é’¥è·¯å¾„">
                            <el-input v-model="taskForm.endpoint_b.ssh_key_path" placeholder="/path/to/id_rsa" />
                        </el-form-item>
                    </template>
                </template>
                <el-form-item label="æ¢è¡Œç¬¦å¤„ç†">
                    <el-radio-group v-model="taskForm.eol_normalize">
                        <el-radio value="lf">LF (Unix)</el-radio>
                        <el-radio value="crlf">CRLF (Windows)</el-radio>
                        <el-radio value="keep">ä¿æŒåŸæ ·</el-radio>
                    </el-radio-group>
                </el-form-item>
                <el-form-item label="æ’é™¤è§„åˆ™">
                    <el-input v-model="excludePatternsText" type="textarea" :rows="3"
                        placeholder="æ¯è¡Œä¸€ä¸ªè§„åˆ™ï¼Œä¾‹å¦‚ï¼š&#10;*.pyc&#10;__pycache__&#10;.git" />
                </el-form-item>
                <el-form-item label="å¯ç”¨ä»»åŠ¡">
                    <el-switch v-model="taskForm.enabled" />
                </el-form-item>
                <el-form-item label="è‡ªåŠ¨å¯åŠ¨">
                    <el-switch v-model="taskForm.auto_start" />
                </el-form-item>
                <el-form-item label="SSH è½®è¯¢é—´éš”(ç§’)"
                    v-if="taskForm.mode === 'two_way' && (taskForm.endpoint_a.type === 'ssh' || taskForm.endpoint_b.type === 'ssh')">
                    <el-input-number v-model="taskForm.poll_interval_seconds" :min="1" :max="300" />
                    <el-text type="info" size="small" style="margin-left: 8px">ä»…å¯¹ SSH ç«¯æœ‰æ•ˆ</el-text>
                </el-form-item>
                <el-form-item label="å›æ”¶ç«™ä¿ç•™(å¤©)">
                    <el-input-number v-model="taskForm.trash_retention_days" :min="0" :max="3650" />
                    <el-text type="info" size="small" style="margin-left: 8px">0 è¡¨ç¤ºä¸æ¸…ç†</el-text>
                </el-form-item>
                <el-form-item label="å¤‡ä»½ä¿ç•™(å¤©)">
                    <el-input-number v-model="taskForm.backup_retention_days" :min="0" :max="3650" />
                    <el-text type="info" size="small" style="margin-left: 8px">0 è¡¨ç¤ºä¸æ¸…ç†</el-text>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="taskDialogVisible = false">å–æ¶ˆ</el-button>
                <el-button type="primary" @click="saveTask">ä¿å­˜</el-button>
            </template>
        </el-dialog>

        <!-- ä»»åŠ¡è¯¦æƒ… -->
        <el-drawer v-model="taskDetailVisible" title="ä»»åŠ¡è¯¦æƒ…" size="520px">
            <template v-if="taskDetail">
                <el-descriptions :column="1" border>
                    <el-descriptions-item label="ä»»åŠ¡åç§°">{{ taskDetail.name || '-' }}</el-descriptions-item>
                    <el-descriptions-item label="åŒæ­¥æ¨¡å¼">
                        {{ taskDetail.mode === 'two_way' ? 'åŒå‘' : 'å•å‘' }}
                    </el-descriptions-item>
                    <el-descriptions-item label="æºç›®å½•">{{ taskDetail.source_path || '-' }}</el-descriptions-item>
                    <el-descriptions-item label="ç›®æ ‡ç±»å‹">{{ taskDetail.target_type || '-' }}</el-descriptions-item>
                    <el-descriptions-item label="ç›®æ ‡">{{ getTargetSummary(taskDetail) }}</el-descriptions-item>
                    <el-descriptions-item label="ç›®æ ‡è·¯å¾„">{{ taskDetail.target_path || '-' }}</el-descriptions-item>
                    <el-descriptions-item v-if="taskDetail.endpoints" label="ç«¯ç‚¹A">
                        {{ getEndpointSummary(taskDetail, 'a') }}
                    </el-descriptions-item>
                    <el-descriptions-item v-if="taskDetail.endpoints" label="ç«¯ç‚¹B">
                        {{ getEndpointSummary(taskDetail, 'b') }}
                    </el-descriptions-item>
                    <el-descriptions-item label="æ¢è¡Œç¬¦">{{ getEolLabel(taskDetail.eol_normalize) }}</el-descriptions-item>
                    <el-descriptions-item label="å¯ç”¨">{{ taskDetail.enabled ? 'æ˜¯' : 'å¦' }}</el-descriptions-item>
                    <el-descriptions-item label="è‡ªåŠ¨å¯åŠ¨">{{ taskDetail.auto_start ? 'æ˜¯' : 'å¦' }}</el-descriptions-item>
                    <el-descriptions-item label="å›æ”¶ç«™ä¿ç•™">
                        {{ taskDetail.trash_retention_days ?? 7 }} å¤©
                    </el-descriptions-item>
                    <el-descriptions-item v-if="taskDetail.mode === 'two_way'" label="SSH è½®è¯¢é—´éš”">
                        {{ taskDetail.poll_interval_seconds ?? 5 }} ç§’
                    </el-descriptions-item>
                    <el-descriptions-item label="å¤‡ä»½ä¿ç•™">
                        {{ taskDetail.backup_retention_days ?? 7 }} å¤©
                    </el-descriptions-item>
                    <el-descriptions-item label="æ’é™¤è§„åˆ™">
                        <el-text v-if="(taskDetail.exclude_patterns || []).length" style="white-space: pre-wrap">
                            {{ (taskDetail.exclude_patterns || []).join('\n') }}
                        </el-text>
                        <el-text v-else type="info">-</el-text>
                    </el-descriptions-item>
                    <el-descriptions-item label="åŒæ­¥æ–‡ä»¶ç±»å‹">
                        <el-text v-if="(taskDetail.file_extensions || []).length">
                            {{ (taskDetail.file_extensions || []).join(', ') }}
                        </el-text>
                        <el-text v-else type="info">å…¨éƒ¨</el-text>
                    </el-descriptions-item>
                </el-descriptions>
            </template>
        </el-drawer>
    </div>

    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Element Plus -->
    <script src="https://unpkg.com/element-plus"></script>
    <!-- Element Plus Icons -->
    <script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.min.js"></script>

    <!-- åº”ç”¨è„šæœ¬ -->
    <script src="/static/js/app.js?v=2.0.0"></script>
</body>

</html>